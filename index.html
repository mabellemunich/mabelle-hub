<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MaBelle Hub</title>
    
    <!-- Tailwind CSS für das Design -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Import Map für saubere Modul-Namen -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
        "lucide-react": "https://esm.sh/lucide-react@0.294.0"
      }
    }
    </script>
    
    <!-- Babel für JSX Unterstützung im Browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #020617; color: white; }
        /* Überschreibe Tailwind Defaults für dunkles Theme */
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { 
          getFirestore, collection, query, onSnapshot, 
          doc, setDoc, deleteDoc, updateDoc, addDoc, getDoc 
        } from 'firebase/firestore';
        import { 
          getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken 
        } from 'firebase/auth';
        import { 
          Shield, Grid, ShoppingCart, Calendar, Briefcase, 
          LogOut, UserPlus, Trash2, Check, X, User, Lock, ExternalLink, Pencil, Save,
          Activity, Clock, FileText, LayoutList, Users, Timer, Settings, Globe, Loader
        } from 'lucide-react';

        // --- Basis Konfiguration (Defaults) ---
        const DEFAULT_APPS = [
          { 
            id: 'manager', 
            name: 'MABELLE MANAGER', 
            description: 'Verwaltung & Finanzen', 
            defaultUrl: 'https://mabelle-manager.netlify.app',
            icon: Briefcase,
            color: 'bg-slate-700' 
          },
          { 
            id: 'order', 
            name: 'MABELLE ORDER', 
            description: 'Bestellwesen & Lager', 
            defaultUrl: 'https://mabelle-order.netlify.app',
            icon: ShoppingCart,
            color: 'bg-emerald-700' 
          },
          { 
            id: 'booking', 
            name: 'MABELLE BOOKING', 
            description: 'Termine & Kunden', 
            defaultUrl: 'https://mabelle-booking.netlify.app',
            icon: Calendar,
            color: 'bg-rose-700' 
          },
          { 
            id: 'timer', 
            name: 'MABELLE TIMER', 
            description: 'Zeiterfassung & Stempeluhr', 
            defaultUrl: 'https://mabelle-timer.netlify.app',
            icon: Timer,
            color: 'bg-indigo-700' 
          }
        ];

        // --- Firebase Konfiguration ---
        // Deine echten Daten wurden hier eingefügt
        const getFirebaseConfig = () => {
            // Prüfung für die Entwicklungsumgebung (Canvas)
            if (window.__firebase_config) {
                return JSON.parse(window.__firebase_config);
            }
            // HIER SIND DEINE DATEN FÜR LOKALE NUTZUNG:
            return {
                apiKey: "AIzaSyBVO3jh0d1FjC0smGcn88eXS16GI1S6PDE",
                authDomain: "mabelle-hub.firebaseapp.com",
                projectId: "mabelle-hub",
                storageBucket: "mabelle-hub.firebasestorage.app",
                messagingSenderId: "242799712815",
                appId: "1:242799712815:web:9c7696ca5c73dc8c5b44da"
            };
        };

        const firebaseConfig = getFirebaseConfig();
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = (typeof window.__app_id !== 'undefined') ? window.__app_id : 'mabelle-hub-default';

        // --- Komponenten ---

        const PinPad = ({ onComplete, disabled }) => {
          const [pin, setPin] = useState('');

          const handleNum = (num) => {
            if (disabled) return;
            if (pin.length < 4) {
              const newPin = pin + num;
              setPin(newPin);
              if (newPin.length === 4) {
                setTimeout(() => {
                  onComplete(newPin);
                  setPin(''); 
                }, 300);
              }
            }
          };

          const handleDelete = () => {
            if (disabled) return;
            setPin(pin.slice(0, -1));
          };

          return (
            <div className="flex flex-col items-center justify-center p-6 bg-slate-900 border border-slate-800 rounded-2xl shadow-2xl max-w-xs mx-auto">
              <div className="mb-6 flex gap-3 h-6">
                {[0, 1, 2, 3].map(i => (
                  <div key={i} className={`w-4 h-4 rounded-full border-2 transition-all duration-300 ${
                    pin.length > i 
                      ? 'bg-amber-600 border-amber-600 shadow-[0_0_10px_rgba(217,119,6,0.5)] scale-110' 
                      : 'border-slate-700 bg-transparent'
                  }`} />
                ))}
              </div>
              <div className="grid grid-cols-3 gap-4">
                {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (
                  <button 
                    key={num} 
                    onClick={() => handleNum(num)}
                    disabled={disabled}
                    className="w-16 h-16 rounded-full bg-slate-800 text-2xl font-semibold text-slate-200 hover:bg-slate-700 hover:text-amber-500 active:bg-slate-600 transition-all shadow-lg border border-slate-700/50 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    {num}
                  </button>
                ))}
                <div className="w-16 h-16"></div>
                <button 
                  onClick={() => handleNum(0)}
                  disabled={disabled}
                  className="w-16 h-16 rounded-full bg-slate-800 text-2xl font-semibold text-slate-200 hover:bg-slate-700 hover:text-amber-500 active:bg-slate-600 transition-all shadow-lg border border-slate-700/50 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  0
                </button>
                <button 
                  onClick={handleDelete}
                  disabled={disabled}
                  className="w-16 h-16 rounded-full flex items-center justify-center text-slate-500 hover:text-amber-500 hover:bg-slate-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <X size={28} />
                </button>
              </div>
            </div>
          );
        };

        function MaBelleHub() {
          const [user, setUser] = useState(null); 
          const [staffList, setStaffList] = useState([]);
          const [logs, setLogs] = useState([]); 
          const [customUrls, setCustomUrls] = useState({}); 
          const [activeStaff, setActiveStaff] = useState(null); 
          const [view, setView] = useState('loading'); 
          const [error, setError] = useState('');
          const [launchingApp, setLaunchingApp] = useState(null); 
          
          // Admin State
          const [formData, setFormData] = useState({ name: '', pin: '', isAdmin: false });
          const [editingId, setEditingId] = useState(null); 
          const [adminTab, setAdminTab] = useState('staff'); 
          const [urlForm, setUrlForm] = useState({}); 

          // --- Initialisierung ---
          useEffect(() => {
            const initAuth = async () => {
                if (typeof window.__initial_auth_token !== 'undefined' && window.__initial_auth_token) {
                    await signInWithCustomToken(auth, window.__initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            };
            initAuth();
            const unsubscribe = onAuthStateChanged(auth, (u) => setUser(u));
            return () => unsubscribe();
          }, []);

          // --- Daten laden ---
          useEffect(() => {
            if (!user) return;
            
            const qStaff = query(collection(db, 'artifacts', appId, 'public', 'data', 'staff'));
            const unsubStaff = onSnapshot(qStaff, (snapshot) => {
              const staff = [];
              snapshot.forEach(doc => staff.push({ id: doc.id, ...doc.data() }));
              setStaffList(staff);
              
              if (view === 'loading') {
                setView('login');
              }
            });

            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'app_urls');
            const unsubConfig = onSnapshot(docRef, (docSnap) => {
              if (docSnap.exists()) {
                const data = docSnap.data();
                setCustomUrls(data);
                setUrlForm(data); 
              }
            });

            return () => {
              unsubStaff();
              unsubConfig();
            };
          }, [user, view]);

          // --- Logs laden ---
          useEffect(() => {
            if (!user || !activeStaff?.isAdmin) return;

            const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'access_logs'));
            const unsubscribe = onSnapshot(q, (snapshot) => {
              const loadedLogs = [];
              snapshot.forEach(doc => loadedLogs.push({ id: doc.id, ...doc.data() }));
              loadedLogs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
              setLogs(loadedLogs);
            });

            return () => unsubscribe();
          }, [user, activeStaff]);

          // --- Logging ---
          const logActivity = async (type, details, staffMember) => {
            try {
              const actor = staffMember || activeStaff;
              if (!actor) return;
              
              await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'access_logs'), {
                type, 
                details,
                userId: actor.id,
                userName: actor.name,
                timestamp: new Date().toISOString()
              });
            } catch (e) {
              console.error("Log error:", e);
            }
          };

          // --- Handlers ---
          const handleCreateFirstAdmin = async () => {
            if (!user) return;
            try {
              await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'staff', 'admin-001'), {
                name: 'Administrator',
                pin: '0000',
                isAdmin: true,
                permissions: ['manager', 'order', 'booking', 'timer'],
                createdAt: new Date().toISOString()
              });
              window.location.reload(); 
            } catch (e) {
              console.error(e);
              setError('Fehler beim Erstellen des Admins: ' + e.message);
            }
          };

          const handleGlobalPinLogin = (enteredPin) => {
            const foundUser = staffList.find(s => s.pin === enteredPin);

            if (foundUser) {
              setActiveStaff(foundUser);
              setView('dashboard');
              setError('');
              logActivity('LOGIN', 'Erfolgreicher Login', foundUser);
            } else {
              setError('PIN nicht erkannt');
              setTimeout(() => setError(''), 2000);
            }
          };

          const handleAppLaunch = async (appConf) => {
            if (launchingApp) return; 
            setLaunchingApp(appConf.id);
            
            try {
              const targetUrl = customUrls[appConf.id] || appConf.defaultUrl;
              const newWindow = window.open('', '_blank');
              if (newWindow) {
                  newWindow.document.write(`
                    <html>
                      <head><title>Verbinde...</title></head>
                      <style>
                        body{background:#020617;color:#fff;display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;font-family:sans-serif;margin:0;}
                        .loader {border: 3px solid #1e293b;border-top: 3px solid #d97706;border-radius: 50%;width: 30px;height: 30px;animation: spin 1s linear infinite;margin-bottom:15px;}
                        @keyframes spin {0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);}}
                      </style>
                      <body>
                        <div class="loader"></div>
                        <div>Logge ein bei ${appConf.name}...</div>
                      </body>
                    </html>
                  `);
              }

              const token = crypto.randomUUID();
              const expiresAt = new Date(Date.now() + 60 * 1000); 

              await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'auth_tokens', token), {
                userId: activeStaff.id,
                userName: activeStaff.name,
                timestamp: new Date().toISOString(),
                expiresAt: expiresAt.toISOString(),
                used: false,
                targetApp: appConf.id
              });

              await logActivity('APP_ACCESS', `App geöffnet: ${appConf.name}`);

              if (newWindow) {
                const separator = targetUrl.includes('?') ? '&' : '?';
                newWindow.location.href = `${targetUrl}${separator}auth_token=${token}`;
              } else {
                 const separator = targetUrl.includes('?') ? '&' : '?';
                 window.location.href = `${targetUrl}${separator}auth_token=${token}`;
              }

            } catch (e) {
              console.error("Launch Error", e);
              alert("Fehler beim Starten der App.");
            } finally {
              setLaunchingApp(null);
            }
          };

          const handleLogout = () => {
            setActiveStaff(null);
            setView('login');
            resetForm();
            setAdminTab('staff');
          };

          const resetForm = () => {
            setFormData({ name: '', pin: '', isAdmin: false });
            setEditingId(null);
          };

          const handleEditClick = (staff) => {
            setFormData({
              name: staff.name,
              pin: staff.pin,
              isAdmin: staff.isAdmin || false
            });
            setEditingId(staff.id);
            window.scrollTo({ top: 0, behavior: 'smooth' });
          };

          const handleSaveStaff = async () => {
            if (!formData.name || formData.pin.length < 4) return;
            const pinExists = staffList.some(s => s.pin === formData.pin && s.id !== editingId);
            if (pinExists) {
                alert("Diese PIN wird bereits verwendet!");
                return;
            }
            try {
              if (editingId) {
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'staff', editingId), {
                  name: formData.name,
                  pin: formData.pin,
                  isAdmin: formData.isAdmin,
                });
                logActivity('ADMIN_ACTION', `Mitarbeiter bearbeitet: ${formData.name}`);
              } else {
                await setDoc(doc(collection(db, 'artifacts', appId, 'public', 'data', 'staff')), {
                  name: formData.name,
                  pin: formData.pin,
                  isAdmin: formData.isAdmin,
                  permissions: formData.isAdmin ? ['manager', 'order', 'booking', 'timer'] : [],
                  createdAt: new Date().toISOString()
                });
                logActivity('ADMIN_ACTION', `Neuer Mitarbeiter angelegt: ${formData.name}`);
              }
              resetForm();
            } catch (e) {
              console.error(e);
              setError('Fehler beim Speichern');
            }
          };

          const handleDeleteStaff = async (id, name) => {
            if(id === activeStaff.id) return;
            await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'staff', id));
            logActivity('ADMIN_ACTION', `Mitarbeiter gelöscht: ${name}`);
          };

          const togglePermission = async (staffId, appIdTarget, currentPermissions) => {
            const perms = currentPermissions || [];
            let newPerms;
            if (perms.includes(appIdTarget)) {
              newPerms = perms.filter(p => p !== appIdTarget);
            } else {
              newPerms = [...perms, appIdTarget];
            }
            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'staff', staffId), {
              permissions: newPerms
            });
          };

          const handleSaveUrls = async () => {
            try {
              await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'app_urls'), urlForm);
              logActivity('ADMIN_ACTION', 'App URLs aktualisiert');
              alert('URLs erfolgreich gespeichert!');
            } catch (e) {
              console.error(e);
              alert('Fehler beim Speichern der URLs');
            }
          };

          // --- Views ---

          if (view === 'loading') {
            return <div className="min-h-screen flex items-center justify-center bg-slate-950 text-amber-600 font-medium tracking-widest animate-pulse">LÄDT MABELLE HUB...</div>;
          }

          if (staffList.length === 0) {
            return (
              <div className="min-h-screen flex flex-col items-center justify-center bg-slate-950 p-4">
                <div className="bg-slate-900 border border-slate-800 p-8 rounded-2xl shadow-2xl max-w-md w-full text-center">
                  <Shield className="w-16 h-16 text-amber-600 mx-auto mb-4" />
                  <h1 className="text-2xl font-bold text-white mb-2">WILLKOMMEN BEI MABELLE HUB</h1>
                  <p className="text-slate-400 mb-6">Erstelle einen Administrator-Account.</p>
                  <button 
                    onClick={handleCreateFirstAdmin}
                    className="w-full bg-gradient-to-r from-amber-700 to-amber-600 text-white py-3 rounded-xl font-bold tracking-wide hover:from-amber-600 hover:to-amber-500 transition-all shadow-lg shadow-amber-900/20"
                  >
                    ADMIN ACCOUNT ERSTELLEN
                  </button>
                </div>
              </div>
            );
          }

          if (view === 'login') {
            return (
              <div className="min-h-screen bg-slate-950 flex flex-col items-center justify-center p-4">
                <div className="mb-10 text-center">
                  <h1 className="text-5xl text-white tracking-widest mb-3">
                     <span className="font-bold">MABELLE</span> <span className="font-normal text-amber-600">HUB</span>
                  </h1>
                  <p className="text-slate-500 uppercase tracking-widest text-xs">Login</p>
                </div>
                
                <PinPad 
                  onComplete={handleGlobalPinLogin} 
                  disabled={false}
                />

                {error && (
                  <div className="mt-8 text-rose-400 font-medium bg-rose-950/30 border border-rose-900/50 px-6 py-3 rounded-lg animate-pulse flex items-center gap-2">
                    <Shield size={16} /> {error}
                  </div>
                )}
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-slate-950 text-slate-200">
              <header className="bg-slate-900 border-b border-slate-800 sticky top-0 z-10 shadow-lg shadow-black/20">
                <div className="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 bg-gradient-to-br from-amber-600 to-amber-700 rounded-lg flex items-center justify-center text-slate-950 font-bold shadow-lg shadow-amber-900/20">M</div>
                    <span className="text-xl tracking-widest text-white">
                      <span className="font-bold">MABELLE</span> <span className="font-normal text-amber-600">HUB</span>
                    </span>
                  </div>
                  
                  <div className="flex items-center gap-6">
                    <div className="text-right hidden sm:block">
                      <div className="text-sm font-medium text-white">{activeStaff.name}</div>
                      <div className="text-[10px] uppercase tracking-wider text-amber-600">{activeStaff.isAdmin ? 'Administrator' : 'Mitarbeiter'}</div>
                    </div>
                    <button 
                      onClick={handleLogout}
                      className="p-3 hover:bg-slate-800 rounded-full text-slate-500 hover:text-amber-500 transition-colors"
                      title="Abmelden"
                    >
                      <LogOut size={20} />
                    </button>
                  </div>
                </div>
              </header>

              <main className="max-w-7xl mx-auto p-6 py-10">
                
                <h2 className="text-xl font-medium text-white mb-8 flex items-center gap-3">
                  <span className="p-2 bg-slate-800 rounded-lg text-amber-500"><Grid size={20} /></span>
                  <span className="tracking-wide">DEINE APPS</span>
                </h2>
                
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-16">
                  {DEFAULT_APPS.map(appConf => {
                    const hasAccess = activeStaff.isAdmin || (activeStaff.permissions || []).includes(appConf.id);
                    const IconComponent = appConf.icon;
                    const isLaunching = launchingApp === appConf.id;
                    
                    if (!hasAccess) return null; 

                    return (
                      <button 
                        key={appConf.id}
                        onClick={() => handleAppLaunch(appConf)} 
                        disabled={isLaunching}
                        className="text-left w-full block bg-slate-900 rounded-2xl shadow-lg border border-slate-800 hover:border-amber-600/50 hover:shadow-2xl hover:shadow-amber-900/10 hover:-translate-y-1 transition-all duration-300 overflow-hidden group cursor-pointer relative"
                      >
                        {isLaunching && (
                          <div className="absolute inset-0 bg-slate-900/80 z-20 flex flex-col items-center justify-center text-amber-500 gap-2">
                            <Loader size={32} className="animate-spin" />
                            <span className="text-xs font-bold uppercase tracking-wider">Verbinde...</span>
                          </div>
                        )}
                        <div className={`h-32 ${appConf.color} flex items-center justify-center text-white/90 relative overflow-hidden`}>
                          <div className="absolute inset-0 bg-black/10 group-hover:bg-transparent transition-colors"></div>
                          <IconComponent size={48} className="opacity-90 group-hover:scale-110 group-hover:rotate-3 transition-transform duration-500 drop-shadow-md" />
                        </div>
                        <div className="p-6">
                          <h3 className="text-base font-bold text-white mb-1 flex items-center gap-2 group-hover:text-amber-500 transition-colors">
                            {appConf.name}
                            <ExternalLink size={14} className="text-slate-600 group-hover:text-amber-500/50" />
                          </h3>
                          <p className="text-slate-400 text-xs">{appConf.description}</p>
                        </div>
                      </button>
                    );
                  })}
                  
                  {(!activeStaff.isAdmin && (!activeStaff.permissions || activeStaff.permissions.length === 0)) && (
                    <div className="col-span-full py-16 text-center bg-slate-900 rounded-2xl border border-dashed border-slate-700">
                      <Lock className="mx-auto w-12 h-12 text-slate-700 mb-4" />
                      <p className="text-slate-400">Keine Apps freigegeben.</p>
                    </div>
                  )}
                </div>

                {activeStaff.isAdmin && (
                  <div className="border-t border-slate-800 pt-10">
                    <h2 className="text-xl font-medium text-white mb-8 flex items-center gap-3">
                      <span className="p-2 bg-slate-800 rounded-lg text-amber-500"><Shield size={20} /></span>
                      <span className="tracking-wide">VERWALTUNG</span>
                    </h2>

                    <div className="flex gap-4 mb-6">
                       <button 
                        onClick={() => setAdminTab('staff')}
                        className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${adminTab === 'staff' ? 'bg-amber-600 text-slate-950' : 'bg-slate-900 text-slate-400 hover:text-white'}`}
                       >
                         <Users size={18} /> Mitarbeiter
                       </button>
                       <button 
                        onClick={() => setAdminTab('apps')}
                        className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${adminTab === 'apps' ? 'bg-amber-600 text-slate-950' : 'bg-slate-900 text-slate-400 hover:text-white'}`}
                       >
                         <Settings size={18} /> Apps
                       </button>
                       <button 
                        onClick={() => setAdminTab('logs')}
                        className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${adminTab === 'logs' ? 'bg-amber-600 text-slate-950' : 'bg-slate-900 text-slate-400 hover:text-white'}`}
                       >
                         <LayoutList size={18} /> Protokoll
                       </button>
                    </div>

                    <div className="bg-slate-900 rounded-2xl shadow-xl border border-slate-800 overflow-hidden min-h-[400px]">
                      
                      {adminTab === 'staff' && (
                        <>
                          <div className={`p-8 border-b border-slate-800 flex flex-wrap gap-6 items-end transition-colors duration-300 ${editingId ? 'bg-amber-900/10' : 'bg-slate-900'}`}>
                            <div className="flex-1 min-w-[200px]">
                              <label className="block text-xs font-bold text-amber-600 uppercase tracking-wider mb-2">
                                {editingId ? 'Mitarbeiter Bearbeiten' : 'Neuer Mitarbeiter Name'}
                              </label>
                              <input 
                                type="text" 
                                value={formData.name}
                                onChange={(e) => setFormData({...formData, name: e.target.value})}
                                className="w-full px-4 py-3 rounded-xl bg-slate-950 border border-slate-800 text-white focus:outline-none focus:ring-2 focus:ring-amber-600/50 focus:border-amber-600 transition-all placeholder:text-slate-600"
                                placeholder="Max Mustermann"
                              />
                            </div>
                            <div className="w-40">
                              <label className="block text-xs font-bold text-amber-600 uppercase tracking-wider mb-2">PIN Code</label>
                              <input 
                                type="text" 
                                maxLength={4}
                                value={formData.pin}
                                onChange={(e) => setFormData({...formData, pin: e.target.value.replace(/\D/g,'')})}
                                className="w-full px-4 py-3 rounded-xl bg-slate-950 border border-slate-800 text-white focus:outline-none focus:ring-2 focus:ring-amber-600/50 focus:border-amber-600 transition-all font-mono text-center placeholder:text-slate-600"
                                placeholder="0000"
                              />
                            </div>
                            <div className="flex items-center gap-3 pb-3 h-12">
                              <div className="relative flex items-center">
                                <input 
                                  type="checkbox" 
                                  id="isAdmin" 
                                  checked={formData.isAdmin}
                                  onChange={(e) => setFormData({...formData, isAdmin: e.target.checked})}
                                  className="peer h-5 w-5 cursor-pointer appearance-none rounded border border-slate-600 bg-slate-950 checked:border-amber-600 checked:bg-amber-600 transition-all"
                                />
                                <Check size={14} className="pointer-events-none absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-black opacity-0 peer-checked:opacity-100" />
                              </div>
                              <label htmlFor="isAdmin" className="text-sm text-slate-300 cursor-pointer select-none font-medium">Admin</label>
                            </div>
                            
                            <div className="flex gap-2">
                              {editingId && (
                                <button 
                                  onClick={resetForm}
                                  className="bg-slate-800 text-slate-400 px-4 py-3 rounded-xl font-bold tracking-wide hover:bg-slate-700 transition-all"
                                >
                                  Abbrechen
                                </button>
                              )}
                              <button 
                                onClick={handleSaveStaff}
                                disabled={!formData.name || formData.pin.length < 4}
                                className="bg-amber-600 text-slate-950 px-8 py-3 rounded-xl font-bold tracking-wide hover:bg-amber-500 disabled:opacity-30 disabled:cursor-not-allowed flex items-center gap-2 transition-all shadow-lg shadow-amber-900/20"
                              >
                                {editingId ? <Save size={18} /> : <UserPlus size={18} />}
                                <span className="uppercase text-xs">{editingId ? 'Speichern' : 'Anlegen'}</span>
                              </button>
                            </div>
                          </div>

                          <div className="overflow-x-auto">
                            <table className="w-full text-left border-collapse">
                              <thead>
                                <tr className="bg-slate-950 text-[10px] uppercase tracking-wider text-slate-500 border-b border-slate-800">
                                  <th className="px-6 py-5 font-bold">Mitarbeiter</th>
                                  <th className="px-4 py-5 font-bold text-center">Manager</th>
                                  <th className="px-4 py-5 font-bold text-center">Order</th>
                                  <th className="px-4 py-5 font-bold text-center">Booking</th>
                                  <th className="px-4 py-5 font-bold text-center">Timer</th>
                                  <th className="px-6 py-5 font-bold text-right">Aktion</th>
                                </tr>
                              </thead>
                              <tbody className="divide-y divide-slate-800">
                                {staffList.map(staff => (
                                  <tr key={staff.id} className={`hover:bg-slate-800/50 transition-colors ${editingId === staff.id ? 'bg-amber-900/5' : ''}`}>
                                    <td className="px-6 py-5">
                                      <div className="font-bold text-white">{staff.name}</div>
                                      <div className="text-xs text-slate-500 font-mono flex items-center gap-2 mt-1">
                                        <span className="bg-slate-800 px-2 py-0.5 rounded text-amber-500 border border-slate-700">PIN: {staff.pin}</span>
                                        {staff.isAdmin && <span className="text-amber-600 font-bold uppercase tracking-wider ml-2">Admin</span>}
                                      </div>
                                    </td>
                                    {DEFAULT_APPS.map(appConf => {
                                      const hasPerm = (staff.permissions || []).includes(appConf.id);
                                      return (
                                        <td key={appConf.id} className="px-4 py-5 text-center">
                                          <button 
                                            onClick={() => togglePermission(staff.id, appConf.id, staff.permissions)}
                                            disabled={staff.isAdmin}
                                            className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all duration-300 ${
                                              staff.isAdmin 
                                                ? 'bg-slate-800/50 text-slate-600 cursor-not-allowed'
                                                : hasPerm 
                                                  ? 'bg-amber-900/30 text-amber-500 border border-amber-700/50 shadow-[0_0_10px_rgba(217,119,6,0.1)]' 
                                                  : 'bg-slate-950 text-slate-700 border border-slate-800 hover:border-slate-600'
                                            }`}
                                          >
                                            {staff.isAdmin || hasPerm ? <Check size={20} strokeWidth={3} /> : <X size={20} />}
                                          </button>
                                        </td>
                                      );
                                    })}
                                    <td className="px-6 py-5 text-right flex justify-end gap-2">
                                      <button 
                                        onClick={() => handleEditClick(staff)}
                                        className="p-3 text-slate-400 hover:text-amber-500 hover:bg-slate-800 rounded-xl transition"
                                      >
                                        <Pencil size={18} />
                                      </button>
                                      <button 
                                        onClick={() => handleDeleteStaff(staff.id, staff.name)}
                                        disabled={staff.id === activeStaff.id}
                                        className="p-3 text-slate-600 hover:text-rose-500 hover:bg-rose-950/30 rounded-xl transition disabled:opacity-20"
                                      >
                                        <Trash2 size={18} />
                                      </button>
                                    </td>
                                  </tr>
                                ))}
                              </tbody>
                            </table>
                          </div>
                        </>
                      )}

                      {adminTab === 'apps' && (
                        <div className="p-8">
                          <h3 className="text-white font-bold mb-6 flex items-center gap-2">
                            <Globe size={20} className="text-amber-500" />
                            App Links konfigurieren
                          </h3>
                          <div className="space-y-6 max-w-3xl">
                            {DEFAULT_APPS.map(appConf => {
                                const IconComponent = appConf.icon;
                                return (
                                  <div key={appConf.id} className="bg-slate-950 p-6 rounded-xl border border-slate-800 flex flex-col md:flex-row gap-4 items-start md:items-center">
                                    <div className={`p-4 rounded-lg ${appConf.color} text-white`}>
                                      <IconComponent size={24} />
                                    </div>
                                    <div className="flex-1 w-full">
                                      <label className="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">
                                        {appConf.name} URL
                                      </label>
                                      <input 
                                        type="text" 
                                        value={urlForm[appConf.id] || appConf.defaultUrl}
                                        onChange={(e) => setUrlForm({...urlForm, [appConf.id]: e.target.value})}
                                        className="w-full px-4 py-3 rounded-lg bg-slate-900 border border-slate-700 text-white focus:outline-none focus:ring-2 focus:ring-amber-600/50 transition-all font-mono text-sm"
                                      />
                                      <p className="text-xs text-slate-600 mt-1">Standard: {appConf.defaultUrl}</p>
                                    </div>
                                  </div>
                                );
                            })}
                            <div className="pt-4 flex justify-end">
                              <button 
                                onClick={handleSaveUrls}
                                className="bg-amber-600 text-slate-950 px-8 py-3 rounded-xl font-bold tracking-wide hover:bg-amber-500 flex items-center gap-2 transition-all shadow-lg shadow-amber-900/20"
                              >
                                <Save size={18} /> SPEICHERN
                              </button>
                            </div>
                          </div>
                        </div>
                      )}

                      {adminTab === 'logs' && (
                        <div className="overflow-x-auto">
                           <table className="w-full text-left border-collapse">
                              <thead>
                                <tr className="bg-slate-950 text-[10px] uppercase tracking-wider text-slate-500 border-b border-slate-800">
                                  <th className="px-8 py-5 font-bold w-48">Zeitpunkt</th>
                                  <th className="px-6 py-5 font-bold w-48">Mitarbeiter</th>
                                  <th className="px-6 py-5 font-bold">Aktivität</th>
                                </tr>
                              </thead>
                              <tbody className="divide-y divide-slate-800">
                                {logs.length === 0 ? (
                                  <tr>
                                    <td colSpan={3} className="px-8 py-12 text-center text-slate-500 italic">
                                      Noch keine Aktivitäten protokolliert.
                                    </td>
                                  </tr>
                                ) : (
                                  logs.map(log => (
                                    <tr key={log.id} className="hover:bg-slate-800/30 transition-colors">
                                      <td className="px-8 py-4 text-slate-400 text-sm font-mono whitespace-nowrap">
                                        <div className="flex items-center gap-2">
                                          <Clock size={14} className="text-slate-600" />
                                          {new Date(log.timestamp).toLocaleString('de-DE')}
                                        </div>
                                      </td>
                                      <td className="px-6 py-4">
                                        <div className="font-medium text-white">{log.userName}</div>
                                      </td>
                                      <td className="px-6 py-4">
                                        <div className="flex items-center gap-2 text-sm text-slate-300">
                                          {log.type === 'LOGIN' && <Activity size={16} className="text-emerald-500" />}
                                          {log.type === 'APP_ACCESS' && <ExternalLink size={16} className="text-amber-500" />}
                                          {log.type === 'ADMIN_ACTION' && <Shield size={16} className="text-rose-500" />}
                                          {log.details}
                                        </div>
                                      </td>
                                    </tr>
                                  ))
                                )}
                              </tbody>
                           </table>
                        </div>
                      )}

                    </div>
                  </div>
                )}

              </main>
            </div>
          );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<MaBelleHub />);
    </script>
</body>
</html>
